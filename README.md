# 地震速報アプリ 運用手順書

## 概要

PC向けWebベースの地震速報アプリケーション。リアルタイムで地震情報を監視・表示し、設定した閾値を超えた場合に通知を行います。

## システム要件

### 必須要件
- **ブラウザ**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **ネットワーク**: インターネット接続必須
- **OS**: Windows 10/11, macOS 10.15+, Linux

### オプション要件（ローカル起動時のみ）
- **Python**: 3.6以上

## 起動方法

### 方法1: ローカル起動（推奨）

```bash
# 1. ターミナル/コマンドプロンプトを開く

# 2. アプリケーションフォルダに移動
cd "/path/to/earthquake-app"
# Windowsの場合: cd "C:\path\to\earthquake-app"

# 3. HTTPサーバーを起動
python3 -m http.server 8080
# Windowsの場合: python -m http.server 8080

# 4. ブラウザで以下のURLにアクセス
# メインアプリ: http://localhost:8080/
# テストモード: http://localhost:8080/test.html
```

**成功時の表示:**
```
Serving HTTP on :: port 8080 (http://[::]:8080/) ...
```

### 方法2: 静的ホスティング（本番運用）

#### GitHub Pages
```bash
git add .
git commit -m "Deploy earthquake app"
git push origin main
# GitHub リポジトリ > Settings > Pages > Source: Deploy from branch
```

#### Netlify/Vercel
1. フォルダをZIPファイルにする
2. Netlify/Vercelにファイルをドラッグ&ドロップ
3. 提供されたURLでアクセス

## 終了方法

### ローカルサーバーの終了

#### 方法1: キーボードショートカット
```bash
Ctrl + C  # ターミナルでサーバーを停止
```

#### 方法2: プロセス終了
```bash
# プロセス確認
ps aux | grep "python3 -m http.server 8080"

# プロセス終了
kill [PID番号]
```

#### 方法3: ポートベース終了（macOS/Linux）
```bash
# ポート8080を使用するプロセスを強制終了
lsof -ti:8080 | xargs kill -9
```

#### Windowsの場合
```cmd
# プロセス確認
tasklist | findstr python

# プロセス終了
taskkill /F /PID [PID番号]
```

## 初回セットアップ

### 1. 通知許可の設定
1. ブラウザでアプリにアクセス
2. 通知許可のダイアログで「**許可**」をクリック
3. 「設定」→「通知テスト」で動作確認

### 2. 設定調整
- **マグニチュード閾値**: 4.0（デフォルト）
- **震度閾値**: 震度3（デフォルト）
- **音量**: 50%（デフォルト）
- **自動ズーム**: 有効（デフォルト）

### 3. 接続状態確認
- ヘッダー右上の接続インジケーター
- **緑**: 正常接続 / **赤**: 切断状態

## 日常運用

### 基本的な使い方
1. アプリを起動してブラウザタブを開いたまま作業
2. 地震発生時、自動で情報表示・通知
3. 設定変更は右上の「設定」ボタンから

### 監視ポイント
- **P2P接続**: 緑色の接続インジケーター
- **API接続**: データ更新の時刻表示
- **通知動作**: テスト機能での確認

### メンテナンス
- **ページリロード**: 1日1回程度（F5キー）
- **履歴クリア**: 自動（7日以上経過したデータ）
- **設定バックアップ**: LocalStorageに自動保存

## トラブルシューティング

### 1. アプリが起動しない

#### Pythonが見つからない場合
```bash
# Python のインストール確認
python3 --version
# または
python --version

# インストールされていない場合
# macOS: brew install python3
# Windows: https://www.python.org/ からダウンロード
```

#### ポートが使用中の場合
```bash
# 別のポートを使用
python3 -m http.server 8081
# ブラウザで http://localhost:8081/ にアクセス
```

### 2. 地震情報が表示されない

#### 接続状態確認
1. P2P接続インジケーターが赤色の場合
   - インターネット接続確認
   - ファイアウォール設定確認
   - ページリロード（F5）

2. データが古い場合
   - ブラウザのDevTools（F12）でエラー確認
   - ページのハードリフレッシュ（Ctrl+Shift+R）

### 3. 通知が出ない

#### ブラウザ通知
```bash
# 通知許可確認方法
1. ブラウザのアドレスバー左側のアイコンをクリック
2. 「通知」が「許可」になっているか確認
3. 「設定」→「通知テスト」で動作確認
```

#### 音声通知
1. システム音量確認
2. ブラウザの音声設定確認
3. 「音声テスト」ボタンで動作確認
4. AudioContext の状態確認（テストログで確認）

### 4. 地図が表示されない

#### Leaflet.jsの読み込み問題
1. インターネット接続確認
2. ブラウザDevTools（F12）→ Networkタブでエラー確認
3. 外部CDNの状態確認（Leaflet.js）

#### JavaScript エラー
1. DevTools（F12）→ Consoleタブでエラー確認
2. 対象エラーでページリロード
3. キャッシュクリア（Ctrl+Shift+Delete）

### 5. 設定が保存されない

#### LocalStorage の問題
```bash
# ブラウザの設定確認
1. DevTools（F12）→ Application/Storage タブ
2. Local Storage → http://localhost:8080
3. 「earthquake_settings」キーが存在するか確認

# 解決方法
1. ブラウザを完全に再起動
2. プライベートモードでないことを確認
3. ブラウザのLocalStorage制限確認
```

## パフォーマンス最適化

### ブラウザ設定
- **通知**: 必要な通知のみ許可
- **自動再生**: 音声通知用に許可
- **JavaScript**: 有効化必須

### システムリソース
- **メモリ使用量**: 約50-100MB（通常）
- **CPU使用率**: 1-3%（通常時）
- **ネットワーク**: 1-5KB/分（通常時）

### 長時間運用時の注意
- 12時間以上の連続使用時は1回リロード推奨
- ブラウザのメモリ使用量が高い場合は再起動

## セキュリティ注意事項

### データ保護
- 個人情報は一切収集・保存しません
- 地震データのみLocalStorageに保存
- 外部通信はHTTPS接続のみ

### アクセス制御
- 外部APIアクセスは読み取り専用
- WebSocket接続は受信のみ
- ローカルファイルシステムへのアクセスなし

## ログ・デバッグ情報

### テストモードの使用
```bash
# テストモードアクセス
http://localhost:8080/test.html

# 利用可能な機能
- P2P接続テスト
- JMA接続テスト  
- 通知テスト
- 音声テスト
- 設定テスト
- 地震シミュレーション
- ログ表示
```

### ブラウザDevTools活用
```bash
# 開発者ツールを開く
F12 または Ctrl+Shift+I

# 重要なタブ
- Console: JavaScript エラー・ログ表示
- Network: API通信状況確認
- Application: LocalStorage データ確認
```

## サポート情報

### よくある質問

**Q: 地震が発生したのに通知が来ません**
A: 設定した閾値（マグニチュード・震度）を下回っている可能性があります。設定を確認してください。

**Q: 音声が出ません**
A: ブラウザのAutoplay制限のため、初回は手動で「音声テスト」ボタンを押してください。

**Q: 地図が表示されません**
A: Leaflet.jsの読み込みに失敗している可能性があります。インターネット接続を確認してください。

**Q: 設定が消えました**
A: ブラウザのローカルストレージがクリアされた可能性があります。再設定してください。

### 更新・改良要望
GitHub Issues や コードレビューを通じて改良要望をお寄せください。

---

**最終更新**: 2025年7月21日  
**バージョン**: 1.0.0  
**対応環境**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+