# 地震速報アプリ 要件定義書

## 1. プロジェクト概要

### 1.1 目的
PC向けWeb地震速報アプリケーション。ブラウザが開いている間、リアルタイムで地震情報を監視・表示する。

### 1.2 背景
- 地震の早期情報取得による安全確保
- P2P地震情報と気象庁情報の両方を活用した迅速かつ正確な情報提供
- PC作業中の地震情報リアルタイム監視

## 2. 機能要件

### 2.1 基本機能
- **リアルタイム地震情報表示**: P2P地震情報（速報）の即座表示
- **地震履歴情報表示**: P2P地震情報API履歴による詳細表示
- **上下分割レイアウト**: 両情報の同時表示
- **通知機能**: ブラウザ通知、音声アラート（800Hz警告音）、視覚的警告
- **設定管理機能**: 閾値設定、音量調整、通知テスト機能

### 2.2 表示情報詳細
- 震度、マグニチュード
- 震源地（インタラクティブ地図表示含む）
- 発生時刻
- 津波情報
- 地震履歴（最新50件、7日間保存）
- 震度分布情報（都道府県別）

### 2.3 画面レイアウト
```
┌───────────────────┬─────────────────┐
│ P2P地震情報 (速報)  │                 │
│ リアルタイム表示   │   インタラクティブ   │
├───────────────────┤      地図表示     │
│ P2P履歴情報       │   (Leaflet.js)   │
│ 過去データ表示     │                 │
└───────────────────┴─────────────────┘
```

## 3. 非機能要件

### 3.1 動作環境
- **対象ブラウザ**: Chrome, Firefox, Safari, Edge（最新版）
- **動作条件**: PCでブラウザタブが開いている間のみ
- **インターネット接続**: 必須

### 3.2 パフォーマンス要件
- P2P情報の更新間隔: 数秒〜リアルタイム
- 気象庁情報の更新間隔: 30秒〜1分
- 初期画面表示: 3秒以内
- 地震発生から速報表示: 15秒以内

### 3.3 可用性要件
- データソース障害時の代替表示
- 接続状態の可視化
- エラー時の自動再接続（最大5回）

## 4. 制約条件

### 4.1 動作制約
- PC電源オフ・スリープ時は動作停止
- ブラウザタブを閉じると機能停止
- モバイル対応は対象外

### 4.2 技術制約
- クライアントサイドのみで動作
- サーバーサイド処理なし
- CORS制約に対応

## 5. データソース

### 5.1 P2P地震情報
- **WebSocket API**: `wss://api.p2pquake.net/v2/ws` でリアルタイム取得
- **REST API**: `https://api.p2pquake.net/v2/history?codes=551&limit=1` で履歴取得
- 速報性重視（数秒〜十数秒）
- 感震情報・震度分布含む

### 5.2 データ統一化
- P2P地震情報APIを主要データソースとして統一使用
- リアルタイム（WebSocket）と履歴（REST API）の両方を活用
- CORS制約なし、認証不要

## 6. 成功指標

### 6.1 KPI
- 地震発生から15秒以内の速報表示
- 99%以上の接続安定性
- 誤報率5%以下の情報精度

### 6.2 測定方法
- WebSocket接続状態の監視
- 情報表示タイムスタンプの記録
- ユーザーフィードバックの収集

## 7. リスクと対策

### 7.1 技術リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| P2P API障害 | 高 | 気象庁情報のみでの運用継続 |
| 気象庁API障害 | 中 | P2P情報のみでの運用継続 |
| WebSocket切断 | 中 | 自動再接続機能 |

### 7.2 運用リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 誤報による混乱 | 高 | 情報ソースの明示、信頼度表示 |
| タブ閉じ忘れ | 低 | 使用方法の明確化 |

## 8. 今後の拡張可能性

### 8.1 機能拡張
- 地域指定フィルタリング
- 震度閾値設定（実装済み）
- 履歴データのエクスポート
- 緊急地震速報対応

### 8.2 システム拡張
- PWA化（オフライン対応）
- モバイル版開発
- デスクトップアプリ化

## 9. 運用要件

### 9.1 PC起動方法
1. **ローカル開発環境**
   ```bash
   cd "/path/to/Jisin -App"
   python3 -m http.server 8080
   ```
   - ブラウザで `http://localhost:8080/` にアクセス

2. **静的ホスティング**
   - GitHub Pages、Netlify、Vercelなど
   - ファイルをそのままアップロード

### 9.2 PC終了方法
```bash
# HTTPサーバープロセスの確認
ps aux | grep "python3 -m http.server"

# プロセス終了
kill [PID]
# または Ctrl+C で終了
```

### 9.3 必要システム要件
- **OS**: Windows 10/11, macOS 10.15+, Linux
- **ブラウザ**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **Python**: 3.6+ (ローカル起動時のみ)
- **ネットワーク**: インターネット接続必須