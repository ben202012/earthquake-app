<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地震速報アプリ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="app-header">
        <h1>地震速報アプリ</h1>
        <div class="connection-status">
            <div class="status-indicator" id="p2p-status">
                <span class="status-dot"></span>
                P2P接続
            </div>
            <div class="status-indicator" id="jma-status">
                <span class="status-dot"></span>
                気象庁API
            </div>
        </div>
        <button class="settings-toggle" id="settings-toggle">設定</button>
    </header>

    <main class="app-main">
        <div class="panels-container">
            <section class="p2p-panel" id="p2p-panel">
                <div class="panel-header">
                    <h2>P2P地震情報 <span class="realtime-badge">LIVE</span></h2>
                    <div class="monitoring-status" id="monitoring-status">
                        <div class="pulse-indicator"></div>
                        <span>監視中</span>
                    </div>
                </div>
                
                <!-- 緊急地震速報ステータス -->
                <div class="eew-status" id="eew-status">
                    <div class="eew-indicator">
                        <div class="eew-icon">⚡</div>
                        <div class="eew-text">
                            <span class="eew-title">緊急地震速報</span>
                            <span class="eew-message" id="eew-message">発信なし</span>
                        </div>
                    </div>
                </div>

                <!-- 日本列島活動状況ダッシュボード -->
                <div class="japan-status-dashboard" id="japan-dashboard">
                    <div class="dashboard-title">🗾 日本列島地震活動状況</div>
                    
                    <!-- リアルタイム時計とカウンター -->
                    <div class="realtime-info">
                        <div class="realtime-clock">
                            <div class="clock-display" id="realtime-clock">--:--:--</div>
                            <div class="clock-label">現在時刻</div>
                        </div>
                        <div class="uptime-counter">
                            <div class="uptime-display" id="uptime-counter">00:00:00</div>
                            <div class="uptime-label">監視時間</div>
                        </div>
                    </div>

                    <!-- データメトリクス -->
                    <div class="metrics-row">
                        <div class="metric-item">
                            <div class="metric-value pulse" id="api-response-time">0ms</div>
                            <div class="metric-label">応答時間</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value" id="last-update-time">未取得</div>
                            <div class="metric-label">最終更新</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value counter-animation" id="data-packets">0</div>
                            <div class="metric-label">受信データ</div>
                        </div>
                    </div>
                    
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-value counter-animation" id="today-count">0</div>
                            <div class="status-label">今日の地震</div>
                        </div>
                        <div class="status-item">
                            <div class="status-value counter-animation" id="week-count">0</div>
                            <div class="status-label">今週の地震</div>
                        </div>
                        <div class="status-item">
                            <div class="status-value pulse" id="max-intensity">-</div>
                            <div class="status-label">最大震度</div>
                        </div>
                        <div class="status-item">
                            <div class="status-value" id="active-regions">-</div>
                            <div class="status-label">活発地域</div>
                        </div>
                    </div>
                </div>

                <!-- 最新地震情報 -->
                <div class="latest-earthquake" id="latest-earthquake">
                    <div class="section-title">📍 最新地震情報</div>
                    <div class="earthquake-info" id="p2p-info">
                        <div class="no-data">
                            <div class="connection-animation">
                                <div class="radar-pulse"></div>
                                <div class="connection-text">地震監視システム起動中...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ライブデータストリーム -->
                <div class="live-data-stream" id="live-data-stream">
                    <div class="section-title">
                        📡 ライブデータストリーム
                        <div class="stream-indicator">
                            <div class="stream-dot"></div>
                            <span class="stream-status">LIVE</span>
                        </div>
                    </div>
                    <div class="stream-container">
                        <div class="stream-scroll" id="live-stream-content">
                            <!-- ライブストリームデータが流れる -->
                        </div>
                    </div>
                </div>

                <!-- アクティビティフィード -->
                <div class="activity-feed" id="activity-feed">
                    <div class="section-title">📊 リアルタイム活動</div>
                    <div class="activity-list" id="activity-list">
                        <!-- 動的に追加される -->
                    </div>
                </div>

            </section>

            <section class="jma-panel" id="jma-panel">
                <h2>気象庁情報</h2>
                <div class="earthquake-info" id="jma-info">
                    <div class="no-data">データ取得中...</div>
                </div>
            </section>
        </div>

        <div class="map-container" id="map-container">
            <div id="earthquake-map"></div>
        </div>
    </main>

    <!-- 右上固定 強震モニタ表示エリア -->
    <div class="fixed-kmoni-panel" id="fixed-kmoni-panel">
        <div class="kmoni-header">
            <div class="kmoni-title">
                <span class="kmoni-icon">📊</span>
                <span class="kmoni-name">強震モニタ</span>
            </div>
            <div class="kmoni-controls">
                <button class="kmoni-refresh-btn" id="kmoni-refresh" title="更新">🔄</button>
                <button class="kmoni-minimize-btn" id="kmoni-minimize" title="最小化">➖</button>
                <button class="kmoni-close-btn" id="kmoni-close" title="閉じる">✕</button>
            </div>
        </div>
        <div class="kmoni-content" id="kmoni-content">
            <div class="kmoni-loading" id="kmoni-loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">強震モニタ読み込み中...</div>
            </div>
            <iframe id="kmoni-iframe" 
                    src="http://www.kmoni.bosai.go.jp"
                    width="100%" 
                    height="100%"
                    frameborder="0"
                    sandbox="allow-scripts allow-same-origin allow-popups allow-forms"
                    loading="lazy">
            </iframe>
        </div>
        <div class="kmoni-status" id="kmoni-status">
            <span class="status-text">http://www.kmoni.bosai.go.jp</span>
        </div>
    </div>

    <aside class="settings-sidebar" id="settings-sidebar">
        <div class="settings-content">
            <h3>設定</h3>
            
            <div class="setting-group">
                <label for="magnitude-threshold">マグニチュード閾値</label>
                <input type="range" id="magnitude-threshold" min="3" max="7" step="0.1" value="4.0">
                <span id="magnitude-value">4.0</span>
            </div>

            <div class="setting-group">
                <label for="intensity-threshold">震度閾値</label>
                <select id="intensity-threshold">
                    <option value="1">震度1</option>
                    <option value="2">震度2</option>
                    <option value="3" selected>震度3</option>
                    <option value="4">震度4</option>
                    <option value="5-">震度5弱</option>
                    <option value="5+">震度5強</option>
                    <option value="6-">震度6弱</option>
                    <option value="6+">震度6強</option>
                    <option value="7">震度7</option>
                </select>
            </div>

            <div class="setting-group">
                <label for="notification-sound">通知音</label>
                <input type="checkbox" id="notification-sound" checked>
                <span>音声通知を有効にする</span>
            </div>

            <div class="setting-group">
                <label for="volume-control">音量</label>
                <input type="range" id="volume-control" min="0" max="100" value="50">
                <span id="volume-value">50%</span>
            </div>

            <div class="setting-group">
                <label for="auto-zoom">自動ズーム</label>
                <input type="checkbox" id="auto-zoom" checked>
                <span>地震発生時に地図を自動ズーム</span>
            </div>

            <div class="setting-group">
                <button class="test-notification" id="test-notification">通知テスト</button>
            </div>

            <button class="reset-settings" id="reset-settings">設定をリセット</button>
        </div>
    </aside>

    <div class="error-message" id="error-message"></div>

    <!-- 緊急情報オーバーレイ -->
    <div class="emergency-overlay" id="emergency-overlay">
        <div class="emergency-alert">
            <div class="alert-header">
                <div class="alert-icon">🚨</div>
                <div class="alert-title" id="alert-title">緊急地震速報</div>
                <div class="alert-level" id="alert-level">WARNING</div>
            </div>
            
            <div class="alert-content">
                <div class="main-message" id="main-message">
                    強い揺れが予想されます
                </div>
                <div class="sub-message" id="sub-message">
                    すぐに安全な場所に避難してください
                </div>
                
                <!-- カウントダウンタイマー -->
                <div class="countdown-section" id="countdown-section">
                    <div class="countdown-label">予想到達時間</div>
                    <div class="countdown-timer" id="countdown-timer">--:--</div>
                </div>
                
                <!-- 地震情報詳細 -->
                <div class="emergency-details" id="emergency-details">
                    <div class="detail-row">
                        <span class="detail-label">震源地:</span>
                        <span class="detail-value" id="emergency-location">---</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">マグニチュード:</span>
                        <span class="detail-value" id="emergency-magnitude">M---</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">予想震度:</span>
                        <span class="detail-value" id="emergency-intensity">震度---</span>
                    </div>
                </div>
            </div>
            
            <div class="alert-actions">
                <div class="action-guide" id="action-guide">
                    1. 頭を保護する　2. 机の下に隠れる　3. 出口を確保する
                </div>
                <button class="dismiss-button" id="dismiss-alert">確認しました</button>
            </div>
        </div>
    </div>

    <!-- 警戒レベルインジケーター -->
    <div class="alert-level-indicator" id="alert-level-indicator">
        <div class="level-bar">
            <div class="level-segment level-1" data-level="1">
                <div class="level-label">安全</div>
            </div>
            <div class="level-segment level-2" data-level="2">
                <div class="level-label">注意</div>
            </div>
            <div class="level-segment level-3" data-level="3">
                <div class="level-label">警戒</div>
            </div>
            <div class="level-segment level-4" data-level="4">
                <div class="level-label">危険</div>
            </div>
            <div class="level-segment level-5" data-level="5">
                <div class="level-label">緊急</div>
            </div>
        </div>
        <div class="current-level" id="current-level">レベル 1</div>
    </div>

    <!-- 地震詳細モーダル -->
    <div class="modal-overlay" id="earthquake-modal-overlay">
        <div class="earthquake-modal" id="earthquake-modal">
            <div class="modal-header">
                <h3 class="modal-title">地震詳細情報</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- 詳細情報がここに動的に挿入される -->
            </div>
            <div class="modal-footer">
                <button class="modal-button secondary" id="modal-close-btn">閉じる</button>
                <button class="modal-button primary" id="modal-map-focus">地図で確認</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="config.js"></script>
    <script src="earthquake-api.js"></script>
    <script src="notification.js"></script>
    <script src="map.js"></script>
    <script src="script.js"></script>
</body>
</html>